# WARNING - Generated by {fusen} from /dev/dev_golem_module.Rmd: do not edit by hand

#' create_shared_link_with_settings
#'
#'This function will allow you to share and get the link for sharing on dropbox
#'
#' https://www.dropboxforum.com/t5/Dropbox-API-Support-Feedback/sharing-create-shared-link-with-settings-unauthorized/td-p/616241
#'
#' @param path The relative path on Dropbox where the file should get uploaded.
#' @param mode - "add" - will not overwrite an existing file in case of a
#'  conflict. With this mode, when a a duplicate file.txt is uploaded, it  will
#'  become file (2).txt. - "overwrite" will always overwrite a file -
#' @param autorename This logical determines what happens when there is a
#'  conflict. If true, the file being uploaded will be automatically renamed to
#'  avoid the conflict. (For example, test.txt might be automatically renamed to
#'  test (1).txt.) The new name can be obtained from the returned metadata. If
#'  false, the call will fail with a 409 (Conflict) response code. The default is `TRUE`
#' @param mute Set to FALSE to prevent a notification trigger on the desktop and
#'  mobile apps
#'  
#' @param dtoken token from the app - with sufficient privileges - 
#'           per default registered within the 
#'           environment as DROPBOX  https://www.dropbox.com/developers/
#'           
#' @references \href{https://www.dropbox.com/developers/documentation/http/documentation#sharing-get_shared_link_file}{API documentation}
#' @importFrom httr POST  add_headers 
#' @export

#' @examples
#' # write.csv(mtcars, file = "mtt.csv")
#' # drop_upload(file="mtt.csv",
#' #             path = "shiny/")
#' # res <- create_shared_link_with_settings(path= "/shiny/mtt.csv")
#' # httr::content(res)$url
create_shared_link_with_settings <- function(
    dtoken = Sys.getenv("DROPBOX"), 
    path) {
  
  req <- httr::POST(
    url = "https://api.dropboxapi.com/2/sharing/create_shared_link_with_settings",
    httr::add_headers(Authorization = paste("Bearer", dtoken, sep = " ")),
    # httr::config(token = token),
    body = list(
      path = path,
      "settings"= list(
        "access" = "viewer",
        "allow_download" = TRUE,
        "audience"= "public",
        "requested_visibility"= "public"
      )
    ),
    encode = "json"
  )
  req
}
