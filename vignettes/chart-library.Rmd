---
title: "Chart Library"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{chart-library}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(unhcrdatapackage)
```

<!-- WARNING - This vignette is generated by {fusen} from /dev/flat_full.Rmd: do not edit by hand -->

<!-- Run this 'development' chunk -->
<!-- Store every call to library() that you need to explore your functions -->


<!--
 You need to run the 'description' chunk in the '0-dev_history.Rmd' file before continuing your code there.

If it is the first time you use {fusen}, after 'description', you can directly run the last chunk of the present file with inflate() inside.
--> 


# Country Questions

## Plot Population type per year

<!--
Create a chunk for the core of the function

- The chunk needs to be named `function` at least
- It contains the code of a documented function
- The chunk can also be named `function-my_median` to make it easily
findable in your Rmd
- Let the `@examples` part empty, and use the next `examples` chunk instead to present reproducible examples

After inflating the template

-  This function code will automatically be added in a new file in the "R/" directory
-->


<!--
Create a chunk with an example of use for your function

- The chunk needs to be named `examples` at least
- It contains working examples of your function
- The chunk is better be named `examples-my_median` to be handled
correctly when inflated as a vignette

After inflating the template

-  This example will automatically be added in the '@examples' part of our function above in the "R/" directory
- This example will automatically be added in the vignette created from this Rmd template
-->


```{r examples-plot_ctr_population_type_per_year, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}

p <- plot_ctr_population_type_per_year(year = 2022,
                                              lag = 5,
                         country_asylum_iso3c = "PAN",
                          pop_type = c("REF", 
                                       "ASY", 
                                       "OIP", 
                                       "OOC",
                                       "STA",
                                       "IDP" )
                  )
p
## Raw data can always be accessed with 
knitr::kable(ggplot2::ggplot_build(p)$plot$data )
```

<!--
Create a chunk with a test of use for your function

- The chunk needs to be named `tests` at least
- It contains working tests of your function
- The chunk is better be named `tests-my_median` to be handled
correctly when inflated as a vignette

After inflating the template

-  This test code will automatically be added in the "tests/testthat/" directory
-->


## Plot Main country of origin  in one specific country - Absolute value

```{r examples-plot_ctr_population_type_abs, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
plot_ctr_population_type_abs(year = 2020,
                    country_asylum_iso3c = "USA",
                    top_n_countries = 4,
                    pop_type = "REF",
                    show_diff_label = FALSE
                    ) 

## Same with 9 top countries and asylum seekers included
plot_ctr_population_type_abs(year = 2020,
                    country_asylum_iso3c = "USA",
                    top_n_countries = 9,
                    pop_type = "ASY",
                    show_diff_label = TRUE
                    ) 

```

## Plot Main country of origin in one specific country - Percentage

```{r examples-plot_ctr_population_type_perc, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}

plot_ctr_population_type_perc(year = 2021,
                    country_asylum_iso3c = "BRA",
                    top_n_countries = 9,
                    pop_type = "REF"  ) 

plot_ctr_population_type_perc(year = 2021,
                    country_asylum_iso3c = "BRA",
                    top_n_countries = 9,
                    pop_type = "ASY"  ) 
```

## Plot Increases and Decreases in Population Groups

```{r examples-plot_ctr_diff_in_pop_groups, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
# 
plot_ctr_diff_in_pop_groups(year = 2022,
                            country_asylum_iso3c = "ARG",
                            pop_type = c("REF", "ASY")
         )

```

## Plot Origin History

    

  

```{r example-plot_ctr_origin_history}
plot_ctr_origin_history(year = 2022,
                        lag = 5,
                        country_asylum_iso3c = "MEX",
                          pop_type = c("REF", 
                                       "ASY", 
                                       "OIP", 
                                       "IDP" ),
                        otherprop = .02)
```

  

  


## Plot Main Destination from  one specific country 

```{r examples-plot_ctr_destination, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
# 
plot_ctr_destination(year = 2021,
                     country_origin_iso3c = "COL",
                     pop_type = c("REF", "ASY")
         )

```

    

## Plot Tree Map of Categories

    

```{r examples-plot_ctr_treemap, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
# 
plot_ctr_treemap(year = 2021,
                            country_asylum_iso3c = "USA",
                            pop_type = c("REF", "ASY")
         )

```

    



## Plot Age Pyramid

    

```{r examples-plot_ctr_pyramid, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
# 
plot_ctr_pyramid(year = 2021,
                 country_asylum_iso3c = "COL",
                 pop_type = c("ASY", "REF")
                 )

```

    

## Plot Refugee Recognition rate

    

  

```{r example-plot_ctr_recognition}
plot_ctr_recognition(year = 2022,
                     country_asylum_iso3c = "USA",
                     top_n_countries = 10, 
                     measure = "RefugeeRecognitionRate",
                     order_by = "TotalDecided" )
```

  

  
    

## Asylum Applications & Decision over time

  

```{r example-plot_ctr_asylum}
plot_ctr_asylum(year = 2022,
                country_asylum_iso3c = "ECU", 
                            lag = 10)
```

  

  


## Average Asylum Processing Time

    

  

```{r example-plot_ctr_processing_time}
plot_ctr_processing_time(year = 2022,
                         country_asylum_iso3c = "ARG")

## Display a filtered version of the chart for a specific country and procedure
plot_ctr_processing_time(year = 2022,
                         country_asylum_iso3c = "EGY",
                         country_origin_iso3c = "ERI",
                         procedureType = "U")

```

  

 
 

## Asylum Processing

    

  

```{r example-plot_ctr_process}
plot_ctr_process(year = 2022,   country_asylum_iso3c = "CHL")
```

  

    


## Plot Solution Over time 

    

  

```{r example-plot_ctr_solution}
plot_ctr_solution(year = 2021,
                  country_asylum_iso3c= "UGA",
                  pop_type = c("REF", "ASY"))
```

  

  




    

## Plot Ratio Refugee Migrant

    

  

```{r example-plot_ctr_disp_migrant}
plot_ctr_disp_migrant(year = 2022,
                    country_asylum_iso3c = "BRA" )
```

  

  
    
    
--- 


# Regional Questions

## Population group in the region  

    

  

```{r example-plot_reg_treemap}
plot_reg_treemap(year = 2022,  region = "Americas")
```

  

  


## Plot World Comparison

    

  

```{r example-plot_reg_share}
plot_reg_share(year = 2022,  
                             region = "Americas",
                             pop_type = "REF")
plot_reg_share(year = 2022,  
                             region = "Americas",
                             pop_type = "ASY")
plot_reg_share(year = 2022,  
                             region = "Americas",
                             pop_type = "OIP")
plot_reg_share(year = 2022,  
                             region = "Americas",
                             pop_type = "IDP")
plot_reg_share(year = 2022,  
                             region = "Americas",
                             pop_type = "STA")
```

  

  


## Evolution Over Time  

    

  

```{r example-plot_reg_evolution}
plot_reg_evolution(year = 2021,
                   lag = 5,
                   region = "Asia",
                   pop_type =  c( "REF", "IDP", "ASY", "OOC", "STA", "OIP"))
```

  

  
 

## Plot Evolution of Population type per year

    

  

```{r example-plot_reg_population_type_per_year}
plot_reg_population_type_per_year(year = 2022,
                                              lag = 5,
                                     region  = "Americas",
                                     pop_type =   c("REF", "ASY", "IDP", "OIP", "STA", "OOC") )
```

  

  


## Plot Population Origin-Destination within the region 

    

  

```{r example-plot_reg_origin_dest}
plot_reg_origin_dest(year = 2022,  region = "Asia")
```

  

  



## Plot Main country of Asylum in the Region

```{r examples-plot_reg_population_type_abs, fig.retina = 2, fig.width = 8, fig.asp = 0.618, fig.align = "center", dev = "ragg_png", out.width = "90%"}
plot_reg_population_type_abs(year = 2022,
                              region = "Americas",
                              top_n_countries = 5,
                              pop_type = "REF",
                              show_diff_label = TRUE
                              )

plot_reg_population_type_abs(year = 2022,
                              region = "Americas",
                              top_n_countries = 5,
                              pop_type = "ASY",
                              show_diff_label = FALSE
                              )

```

## Plot Biggest decrease in Refugee Population

 
    

  

```{r example-plot_reg_decrease}
plot_reg_decrease(year = 2021,
                  lag = 5,
                  topn = 5,
                  region = "Americas",
                  pop_type = c("REF", "ASY", "OIP"))
```

  

  
    

## Plot Biggest increase in Refugee Population 

    

  

```{r example-plot_reg_increase}
plot_reg_increase(year = 2021,
                  lag = 5,
                  topn = 5,
                  region = "Americas",
                  pop_type = c("REF", "ASY", "OIP"))

plot_reg_increase(year = 2021,
                  lag = 5,
                  topn = 5,
                  region = "Asia",
                  pop_type = c("REF", "ASY", "OIP"))
```

  

  


## Proportion of the population who are refugees, by country of origin  (SDG indicator 10.7.4 ) 

    

  

```{r example-plot_reg_prop_origin}
plot_reg_prop_origin(year = 2022,  region = "Americas")
```

  

  
 


## Decision on Refugee Status Determination

  

```{r example-plot_reg_rsd}
plot_reg_rsd(year = 2022,
             region = "Americas" ,
                        top_n_countries = 10, 
                        measure = "Recognized")


plot_reg_rsd(year = 2022,
             region = "Americas" ,
                        top_n_countries = 5, 
                        measure = "ComplementaryProtection")


plot_reg_rsd(year = 2022,
             region = "Americas" ,
                        top_n_countries = 10, 
                        measure = "TotalDecided")


plot_reg_rsd(year = 2022,
             region = "Americas" ,
                        top_n_countries = 10, 
                        measure = "RefugeeRecognitionRate")


plot_reg_rsd(year = 2022,
             region = "Americas" ,
                        top_n_countries = 10, 
                        measure = "TotalRecognitionRate")


# plot_reg_rsd(year = 2022,
#              region = "Europe", 
#                         top_n_countries = 10, 
#                         measure = "Recognized")
```

  

  


    

## Plot Evolution of Solutions in the Region

    

  

```{r example-plot_reg_solution}
plot_reg_solution(year = 2022, 
                            region = "Americas",
                            lag = 10)
```

  

  


## Mapping Population  

    

  

```{r example-plot_reg_map}
plot_reg_map(  year = 2022,
                            region = "Asia",
                            topn = 5,
                            pop_type =  c("REF", "ASY", "OIP"),
                            projection = "Mercator",
                            maxSymbolsize = .25)


# plot_reg_map(  year = 2022,
#                             region = "WestAfrica",
#                             topn = 5,
#                             pop_type =  c("REF", "ASY", "OIP"),
#                             projection = "Mercator",
#                             maxSymbolsize = .25)

```

  

  
 
    
     


--- 


# Report Templates

Templates are re-built notebook that includes all the plotting functions above and are integrated with report parameters. Templates are available both as html report (that can be converted to PDF) and as PowerPoint presentations, all defined from UNHCR standard brand (cf [unhcrdown](https://github.com/vidonne/unhcrdown). The templates are available either for countries or regions.


## Country Factsheet

```{r example-template_CtryFactsheet}
## generate for one country
# template_CtryFactsheet(year = 2022, country_asylum_iso3c = "USA",   folder = "Report")

# ## Generate for a specific region
# region <- "Americas"
# year <- 2022
# library(tidyverse)
# ## get all countries with more than 1000 Reported individuals
# ctr <- dplyr::left_join( x= unhcrdatapackage::end_year_population_totals_long,
#                                 y= unhcrdatapackage::reference,
#                                 by = c("CountryAsylumCode" = "iso_3")) %>%
#         filter(Year == year &
#                 UNHCRBureau == region ) %>%
#         group_by( CountryAsylumName, CountryAsylumCode   ) %>%
#         summarise(Value = sum(Value) ) %>%
#         ungroup() %>%
#         filter( Value  > 1000 )
# 
# for ( i in (1:nrow(ctr))) {
#     # i <- 1
#     country_asylum_iso3ci = as.character(ctr[i ,2 ])
#     cat(paste0(country_asylum_iso3ci, "\n"))
#     unhcrdatapackage::template_CtryFactsheet(year = 2022, country_asylum_iso3c = country_asylum_iso3ci,   folder = "Report")  }
```

## Country Presentation

```{r example-template_CtryPrez}
## generate for one country
# unhcrdatapackage::template_CtryPrez(year = 2022, country_asylum_iso3c = "CHL",   folder = "Report")

# ## Generate for a specific region
# region <- "Americas"
# year <- 2022
# library(tidyverse)
# ## get all countries with more than 1000 Reported individuals
# ctr <- dplyr::left_join( x= unhcrdatapackage::end_year_population_totals_long,
#                                 y= unhcrdatapackage::reference,
#                                 by = c("CountryAsylumCode" = "iso_3")) %>%
#         filter(Year == year &
#                 UNHCRBureau == region ) %>%
#         group_by( CountryAsylumName, CountryAsylumCode   ) %>%
#         summarise(Value = sum(Value) ) %>%
#         ungroup() %>%
#         filter( Value  > 1000 )
# 
# for ( i in (1:nrow(ctr))) {
#     # i <- 1
#     country_asylum_iso3ci = as.character(ctr[i ,2 ])
#     cat(paste0(country_asylum_iso3ci, "\n"))
#     unhcrdatapackage::template_CtryFactsheet(year = 2022, country_asylum_iso3c = country_asylum_iso3ci,   folder = "Report")  }
```

## Regional Factsheet

```{r example-template_RegFactsheet}

# template_RegFactsheet(year = 2022, region = "Europe", lag = 10,   folder = "Report")

## We can also generate all factsheets in a loop for 2022

# region <-  unhcrdatapackage::reference |>
#   dplyr::distinct(UNHCRBureau) |>
#   dplyr::filter(!(is.na(UNHCRBureau))) |>
#   dplyr::pull()
# 
# for( reg in region) {
#   unhcrdatapackage::template_RegFactsheet(year = 2022, 
#                         region = reg, lag = 10,   folder = "Report")
# }



```

## Regional Presentation

```{r example-template_RegPrez}
# template_RegPrez(year = 2022, region = "Americas", lag = 10,   folder = "Report")

# # Generate for a specific region
# region <- "Americas"
# year <- 2022
# library(tidyverse)
# ## get all countries with more than 1000 Reported individuals
# ctr <- dplyr::left_join( x= unhcrdatapackage::end_year_population_totals_long,
#                                 y= unhcrdatapackage::reference,
#                                 by = c("CountryAsylumCode" = "iso_3")) %>%
#         filter(Year == year &
#                 UNHCRBureau == region ) %>%
#         group_by( CountryAsylumName, CountryAsylumCode   ) %>%
#         summarise(Value = sum(Value) ) %>%
#         ungroup() %>%
#         filter( Value  > 1000 )
# 
#   for ( i in (1:nrow(ctr))) {
#     # i <- 1
#     country_asylum_iso3c = as.character(ctr[i ,2 ])
#     cat(paste0(country_asylum_iso3c, "\n"))
#     unhcrdatapackage::template_CtryPrez(year = 2022, country_asylum_iso3c = country_asylum_iso3c,   folder = "Report")
#   }
```

# Update Dataset

    

  

```{r example-update_dataset}
#update_dataset()
```

  

  


# Refresh package

